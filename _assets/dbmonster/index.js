var H=100,ae=function(){function n(e,t,i,s){this.min=e,this.max=t,this.mean=i,this.last=s}return n}(),F=function(){function n(e){this.samples=[],this.maxSamples=e,this._i=-1}return n.prototype.addSample=function(e){this._i=(this._i+1)%this.maxSamples,this.samples[this._i]=e},n.prototype.each=function(e){for(var t=this.samples,i=0;i<t.length;i++)e(t[(this._i+1+i)%t.length],i)},n.prototype.calc=function(){var e=this.samples;if(e.length===0)return new ae(0,0,0,0);for(var t=e[(this._i+1)%e.length],i=t,s=0,a=0;a<e.length;a++){var l=e[(this._i+1+a)%e.length];l<t&&(t=l),l>i&&(i=l),s+=l}var r=e[this._i],o=s/e.length;return new ae(t,i,o,r)},n}(),Ae=function(){function n(){this.value=0,this.onChange=null}return n.prototype.inc=function(e){e>0&&(this.value+=e,this.onChange())},n}(),Pe=function(){function n(e,t){this.value=t,this.next=null}return n}(),Re=function(){function n(e){var t=this;this._dec=function(){for(var i=performance.now();t._firstTimestamp!==null;){var s=t._firstTimestamp;if(i>=s.value)t.value-=s.value,t._firstTimestamp=t._firstTimestamp.next;else{setTimeout(t._dec,Math.ceil(s.value-i));break}}t._firstTimestamp===null&&(t._lastTimestamp=null),t.onChange()},this.interval=e,this.value=0,this.onChange=null,this._firstTimestamp=null,this._lastTimestamp=null}return n.prototype.inc=function(e){if(e>0){var t=new Pe(performance.now()+this.interval,e);this._firstTimestamp===null?(this._firstTimestamp=t,setTimeout(this._dec,this.interval)):this._lastTimestamp.next=t,this._lastTimestamp=t,this.value+=e,this.onChange()}},n}(),z=[],re=-1;function Oe(n){z.push(n),re===-1&&requestAnimationFrame(function(e){re=-1;var t=z;z=[];for(var i=0;i<t.length;i++)t[i]()})}var ce=function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(e,t){n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),k=30,oe=H,ue=function(){function n(e){var t=this;this._sync=function(){t.sync(),t._dirty=!1},this.name=e,this.element=document.createElement("div"),this.element.style.cssText="padding: 2px;background-color: #020;font-family: monospace;font-size: 12px;color: #0f0",this._dirty=!1,this.invalidate()}return n.prototype.invalidate=function(){this._dirty||(this._dirty=!0,Oe(this._sync))},n.prototype.sync=function(){throw new Error("sync method not implemented")},n}(),u;(function(n){n[n.HideMin=1]="HideMin",n[n.HideMax=2]="HideMax",n[n.HideMean=4]="HideMean",n[n.HideLast=8]="HideLast",n[n.HideGraph=16]="HideGraph",n[n.RoundValues=32]="RoundValues"})(u||(u={}));var Q=function(n){ce(e,n);function e(t,i,s,a){var l=n.call(this,t)||this;l.flags=i,l.unitName=s,l.samples=a;var r=document.createElement("div");r.style.cssText="text-align: center",r.textContent=l.name;var o=document.createElement("div");return i&u.HideMin?l.minText=null:(l.minText=document.createElement("div"),o.appendChild(l.minText)),i&u.HideMax?l.maxText=null:(l.maxText=document.createElement("div"),o.appendChild(l.maxText)),i&u.HideMean?l.meanText=null:(l.meanText=document.createElement("div"),o.appendChild(l.meanText)),i&u.HideLast?l.lastText=null:(l.lastText=document.createElement("div"),o.appendChild(l.lastText)),l.element.appendChild(r),l.element.appendChild(o),i&u.HideGraph?(l.canvas=null,l.ctx=null):(l.canvas=document.createElement("canvas"),l.canvas.style.cssText="display: block; padding: 0; margin: 0",l.canvas.width=oe,l.canvas.height=k,l.ctx=l.canvas.getContext("2d"),l.element.appendChild(l.canvas)),l}return e.prototype.sync=function(){var t=this,i=this.samples.calc(),s=k/(i.max*1.2),a,l,r,o;this.flags&u.RoundValues?(a=Math.round(i.min).toString(),l=Math.round(i.max).toString(),r=Math.round(i.mean).toString(),o=Math.round(i.last).toString()):(a=i.min.toFixed(2),l=i.max.toFixed(2),r=i.mean.toFixed(2),o=i.last.toFixed(2)),this.minText!==null&&(this.minText.textContent="min: \xA0"+a+this.unitName),this.maxText!==null&&(this.maxText.textContent="max: \xA0"+l+this.unitName),this.meanText!==null&&(this.meanText.textContent="mean: "+r+this.unitName),this.lastText!==null&&(this.lastText.textContent="last: "+o+this.unitName),this.ctx!==null&&(this.ctx.fillStyle="#010",this.ctx.fillRect(0,0,oe,k),this.ctx.fillStyle="#0f0",this.samples.each(function(c,h){t.ctx.fillRect(h,k,1,-(c*s))}))},e}(ue),De=function(n){ce(e,n);function e(t,i){var s=n.call(this,t)||this;return s.counter=i,s.text=document.createElement("div"),s.element.appendChild(s.text),s}return e.prototype.sync=function(){this.text.textContent=this.name+": "+this.counter.value},e}(ue),_=null,je=!1;function U(){_||(_=document.createElement("div"),_.style.cssText="position: fixed;opacity: 0.9;right: 0;bottom: 0",document.body.appendChild(_)),je=!0}function fe(n){n===void 0&&(n=u.HideMin|u.HideMax|u.HideMean|u.RoundValues),U();var e=new F(H),t=new Q("FPS",n,"",e);_.appendChild(t.element);var i=2/121,s=0,a=60;function l(r){s>0&&(a+=i*(1e3/(r-s)-a)),s=r,e.addSample(a),t.invalidate(),requestAnimationFrame(l)}requestAnimationFrame(l)}function he(n){if(n===void 0&&(n=u.HideMin|u.HideMean),U(),performance.memory===void 0)return;var e=new F(H),t=new Q("Memory",n,"MB",e);_.appendChild(t.element);function i(){e.addSample(Math.round(performance.memory.usedJSHeapSize/(1024*1024))),t.invalidate(),setTimeout(i,30)}i()}var Ve=function(){function n(e,t,i){this.data=new F(H),this.widget=new Q(e,i,t,this.data),this.startTime=-1}return n}(),$={},et=function(){function n(e,t){var i=this;this.data=t===void 0?new Ae:new Re(t),this.widget=new De(e,this.data),this.data.onChange=function(){i.widget.invalidate()}}return n}();function de(n,e){e===void 0&&(e=0),U();var t=$[n];t===void 0&&($[n]=t=new Ve(n,"ms",e),_.appendChild(t.widget.element))}function pe(n){var e=$[n];e!==void 0&&(e.startTime=performance.now())}function me(n){var e=performance.now(),t=$[n];t!==void 0&&t.startTime!==-1&&(t.data.addSample(e-t.startTime),t.widget.invalidate())}function T(n,e){let t=document.createElement("template");if(t.innerHTML=n,e){let i=t.content,s=i.firstChild,a;for(s.remove();a=s.firstChild;)i.appendChild(a)}return t}function C(n){return document.importNode(n.content,!0)}function m(n,e){let t=n,i=0,s=e.length,a,l;for(;i<s;i++)for(a=e[i],t=t.firstChild,l=0;l<a;l++)t=t.nextSibling;return t}function ye(n,e,t){if(n.replaceWith(e),t){let i;for(;i=n.firstChild;)e.appendChild(i)}}function S(n,e){n.append(e)}function I(n,e){n.after(e)}function ge(n,e){let t=n;if(e.nextSibling!==n)for(;t;){let i=t;if(t=t.nextSibling,i.remove(),i===e)break}}function L(n,e,t){n.setAttribute(e,t)}var P=Object,Le=Symbol,Ge=/\B([A-Z])/g;function be(n){return n.replace(Ge,"-$1").toLowerCase()}var Be=P.is,qe=P.assign,G=n=>typeof n=="function";var R,b=1<<0,J=1<<1,ve=1<<2,K=1<<3,tt=1<<4,we=1<<5,ze=(n,e)=>n.e-e.e,f,p,v,d=0,N,A=0,X=0,Te=0,Y=0;function Ce(){A++}function Se(){if(A>1){A--;return}let n,e=!1;for(;N;){let t=N.sort(ze),i=0,s=t.length;for(N=R,X++;i<s;i++){let a=t[i];if(a.c&=~J,!(a.c&K)&&Fe(a))try{a.l()}catch(l){e||(n=l,e=!0)}}}if(X=0,A--,e)throw n}function Fe(n){let e=n.b,t=e.length,i=0,s;for(;i<t;i++)if(s=e[i],s.d>n.d||s.h())return!0;return!1}function Qe(){let n=p.b;if(v){if(_e(),d>0){let e=v.length,t=0;for(n.length=d+e;t<e;t++)n[d+t]=v[t]}else n=p.b=v;if(p.c&we){let e=n.length,t=d;for(;t<e;t++)n[t].i(p)}}else d<p.b.length&&(_e(),n.length=d)}function _e(){let n=p.b,e=n.length,t=d;for(;t<e;t++)n[t].g(p)}function xe(n){let e=n.b,t=e.length,i=0;for(;i<t;i++)e[i].g(n);e.length=0}var O=class{constructor(e){let t=this;t.a=e,t.d=-1,t.f=[],t.m=-1}h(){return!1}i(e){this.f.push(e)}g(e){let i=this.f,s=i.indexOf(e);i.splice(s,1)}peek(){return this.a}get value(){let e=this;return p&&e.m!==Y&&(e.m=Y,v?v.push(e):p.b[d]===e?d++:v=[e]),e.a}set value(e){let t=this;if(t.a!==e&&(t.a=e,t.d=++Te,X<100)){let i=t.f,s=i.length,a=0;for(Ce();a<s;a++)i[a].j();Se()}}};var D=class{constructor(e){let t=this;t.k=e,t.d=0,t.b=[],t.c=we,t.e=0}l(){let e=this;if(e.c&b)return;e.d=Te,e.c|=b,e.c&=~ve;let t=p,i=v,s=d;try{Ce(),p=e,v=R,d=0,Y++,e.k()}finally{Qe(),p=t,v=i,d=s,e.c&=~b,e.c&K&&xe(e),Se()}}j(){let e=this;e.c&(J|b)||(e.c|=ve|J,(N||=[]).push(e))}o(){let e=this;e.c|=K,e.c&b||xe(e)}},j=class{constructor(e){let t=this;t.scopes=[],t.cleanups=[],t.parent=R,t.e=0,!e&&f&&(t.parent=f,t.e=f.e+1,f.scopes.push(t))}run(e){let t=f;try{return f=this,e()}finally{f=t}}clear(){let e=this,t=e.scopes,i=e.cleanups;for(let s of t)s.clear(),s.parent=R;for(let s of i)s();t.length=0,i.length=0}};function Z(n){return new j(n)}function Ee(n){G(n)&&f&&f.cleanups.push(n)}function W(n){return new O(n)}function y(n){let e=new D(n),t=e.o.bind(e);try{e.l()}catch(i){throw t(),i}return f&&e.b.length>0&&(e.e=f.e,f.cleanups.push(t)),t}var Ue=!1,Je=1;var w=null,ee=Le(),V=class extends HTMLElement{$m=!1;$c=Z(!0);$p={};$h=[];constructor(){super();let e=this,t=e.$p,i=e.constructor.$d;for(let s in i){let a=i[s];t[a]=W(ee)}}connectedCallback(){let e=this;if(!e.$m){e.$m=!0;let t=e.constructor.$c,i=e.constructor.$s,s=e.$c,a=e.$h,l=e.shadowRoot,r=!1;l||(l=e.attachShadow({mode:"open"}),r=!0);let o=w;try{if(w=e,s.run(()=>t(l,e)),document.adoptedStyleSheets)r&&(l.adoptedStyleSheets=i);else for(let c of i)S(l,c.cloneNode(!0));for(let c of a){let h=c();G(h)&&s.cleanups.push(h)}a.length=0}finally{w=o}}}disconnectedCallback(){let e=this;e.$m&&(e.$c.clear(),e.shadowRoot.innerHTML="",e.$m=!1)}attributeChangedCallback(e,t,i){let s=this,a=s.constructor.$d;e in a&&(s.$p[a[e]].value=i===""?!0:i)}};function te(n,e,t,i){let s=[],a=P.create(null);class l extends V{static observedAttributes=s;static $c=e;static $a=a;static $d=t;static $s=i}for(let r in t){let o=t[r],c=be(r);a[c]=r,s.push(c),P.defineProperty(l.prototype,r,{get(){return this.$p[o].a},set(h){this.$p[o].value=h}})}return Ue&&(n="velvet-"+Je++),n&&customElements.define(n,l),l}function ne(n,e){let t=w.$p[n];return t.value===ee&&(t.value=G(e)?e():e),t}function E(n,e){let t=document.createTextNode("");n.nodeType===1?S(n,t):ye(n,t,!1),y(()=>t.data=e())}function ie(n,e,t){let i=[],s=f.e+1;y(()=>{let a=t(),l=0,r=a.length,o=i.length;for(;l<r;l++)if(i[l]){let c=i[l][2];c.value=a[l]}else{let c=i[l-1],h=c?c[1]:n,x=W(a[l]),g=Z(!0);g.e=s,i[l]=[g,g.run(()=>e(h,x,l)),x]}if(o>r){let c=i[l-1],h=c?c[1]:n,x=i[o-1][1];for(;l<o;l++)i[l][0].clear();Ke(h,x),i.length=r}}),Ee(()=>{for(let a=0,l=i.length;a<l;a++)i[a][0].clear()})}function Ke(n,e){ge(n.nextSibling,e)}var Xe=T("<table class='table table-striped latest-data'><tbody><!></tbody></table>"),Ye=T("<tr><td class=dbname><!></td><td class=query-count><span> <!> </span></td></tr>"),Ze=T("<td><!> <div class='popover left'><div class=popover-content></div><div class=arrow></div></div></td>");function We(n,e){let t=ne(0,()=>[]),i=C(Xe),s=m(i,[0,0,0]);ie(s,(l,r)=>{let o=C(Ye),c=m(o,[0,0,0]),h=m(o,[0,1,0,1]),x=m(o,[0,1,0]),g=m(o,[0,1]),Me=m(o,[0]),ke=($e,q)=>{let M=C(Ze),He=m(M,[0,0]),Ne=m(M,[0,2,0]),se=m(M,[0]);return E(He,()=>q.value.formatElapsed),E(Ne,()=>q.value.query),y(()=>L(se,"class",`Query ${q.value.elapsedClassName}`)),I($e,M),se};return E(c,()=>r.value.dbname),E(h,()=>r.value.lastSample.nbQueries),y(()=>L(x,"class",r.value.lastSample.countClassName)),ie(g,ke,()=>r.value.lastSample.topFiveQueries),I(l,o),Me},()=>t.value),S(n,i)}var le=te("x-app",We,{dbs:0},[]);le.prototype.attachShadow=function(){return this};var B=new le;B.dbs=ENV.generateData().toArray();document.body.appendChild(B);if(/[&?]perfmon=(false|off|0)\b/.test(location.search)){let n=function(){let e=ENV.generateData().toArray();B.dbs=e,setTimeout(n,ENV.timeout)};n()}else{let n=function(){let e=ENV.generateData().toArray();pe("view update"),B.dbs=e,me("view update"),setTimeout(n,ENV.timeout)};fe(),he(),de("view update"),n()}
//# sourceMappingURL=index.js.map
