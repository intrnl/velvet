var N=100,he=function(){function n(e,t,i,l){this.min=e,this.max=t,this.mean=i,this.last=l}return n}(),J=function(){function n(e){this.samples=[],this.maxSamples=e,this._i=-1}return n.prototype.addSample=function(e){this._i=(this._i+1)%this.maxSamples,this.samples[this._i]=e},n.prototype.each=function(e){for(var t=this.samples,i=0;i<t.length;i++)e(t[(this._i+1+i)%t.length],i)},n.prototype.calc=function(){var e=this.samples;if(e.length===0)return new he(0,0,0,0);for(var t=e[(this._i+1)%e.length],i=t,l=0,a=0;a<e.length;a++){var s=e[(this._i+1+a)%e.length];s<t&&(t=s),s>i&&(i=s),l+=s}var o=e[this._i],r=l/e.length;return new he(t,i,r,o)},n}(),De=function(){function n(){this.value=0,this.onChange=null}return n.prototype.inc=function(e){e>0&&(this.value+=e,this.onChange())},n}(),je=function(){function n(e,t){this.value=t,this.next=null}return n}(),Ve=function(){function n(e){var t=this;this._dec=function(){for(var i=performance.now();t._firstTimestamp!==null;){var l=t._firstTimestamp;if(i>=l.value)t.value-=l.value,t._firstTimestamp=t._firstTimestamp.next;else{setTimeout(t._dec,Math.ceil(l.value-i));break}}t._firstTimestamp===null&&(t._lastTimestamp=null),t.onChange()},this.interval=e,this.value=0,this.onChange=null,this._firstTimestamp=null,this._lastTimestamp=null}return n.prototype.inc=function(e){if(e>0){var t=new je(performance.now()+this.interval,e);this._firstTimestamp===null?(this._firstTimestamp=t,setTimeout(this._dec,this.interval)):this._lastTimestamp.next=t,this._lastTimestamp=t,this.value+=e,this.onChange()}},n}(),K=[],de=-1;function Ie(n){K.push(n),de===-1&&requestAnimationFrame(function(e){de=-1;var t=K;K=[];for(var i=0;i<t.length;i++)t[i]()})}var me=function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(e,t){n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),H=30,pe=N,ve=function(){function n(e){var t=this;this._sync=function(){t.sync(),t._dirty=!1},this.name=e,this.element=document.createElement("div"),this.element.style.cssText="padding: 2px;background-color: #020;font-family: monospace;font-size: 12px;color: #0f0",this._dirty=!1,this.invalidate()}return n.prototype.invalidate=function(){this._dirty||(this._dirty=!0,Ie(this._sync))},n.prototype.sync=function(){throw new Error("sync method not implemented")},n}(),f;(function(n){n[n.HideMin=1]="HideMin",n[n.HideMax=2]="HideMax",n[n.HideMean=4]="HideMean",n[n.HideLast=8]="HideLast",n[n.HideGraph=16]="HideGraph",n[n.RoundValues=32]="RoundValues"})(f||(f={}));var Y=function(n){me(e,n);function e(t,i,l,a){var s=n.call(this,t)||this;s.flags=i,s.unitName=l,s.samples=a;var o=document.createElement("div");o.style.cssText="text-align: center",o.textContent=s.name;var r=document.createElement("div");return i&f.HideMin?s.minText=null:(s.minText=document.createElement("div"),r.appendChild(s.minText)),i&f.HideMax?s.maxText=null:(s.maxText=document.createElement("div"),r.appendChild(s.maxText)),i&f.HideMean?s.meanText=null:(s.meanText=document.createElement("div"),r.appendChild(s.meanText)),i&f.HideLast?s.lastText=null:(s.lastText=document.createElement("div"),r.appendChild(s.lastText)),s.element.appendChild(o),s.element.appendChild(r),i&f.HideGraph?(s.canvas=null,s.ctx=null):(s.canvas=document.createElement("canvas"),s.canvas.style.cssText="display: block; padding: 0; margin: 0",s.canvas.width=pe,s.canvas.height=H,s.ctx=s.canvas.getContext("2d"),s.element.appendChild(s.canvas)),s}return e.prototype.sync=function(){var t=this,i=this.samples.calc(),l=H/(i.max*1.2),a,s,o,r;this.flags&f.RoundValues?(a=Math.round(i.min).toString(),s=Math.round(i.max).toString(),o=Math.round(i.mean).toString(),r=Math.round(i.last).toString()):(a=i.min.toFixed(2),s=i.max.toFixed(2),o=i.mean.toFixed(2),r=i.last.toFixed(2)),this.minText!==null&&(this.minText.textContent="min: \xA0"+a+this.unitName),this.maxText!==null&&(this.maxText.textContent="max: \xA0"+s+this.unitName),this.meanText!==null&&(this.meanText.textContent="mean: "+o+this.unitName),this.lastText!==null&&(this.lastText.textContent="last: "+r+this.unitName),this.ctx!==null&&(this.ctx.fillStyle="#010",this.ctx.fillRect(0,0,pe,H),this.ctx.fillStyle="#0f0",this.samples.each(function(u,p){t.ctx.fillRect(p,H,1,-(u*l))}))},e}(ve),Le=function(n){me(e,n);function e(t,i){var l=n.call(this,t)||this;return l.counter=i,l.text=document.createElement("div"),l.element.appendChild(l.text),l}return e.prototype.sync=function(){this.text.textContent=this.name+": "+this.counter.value},e}(ve),y=null,Be=!1;function Z(){y||(y=document.createElement("div"),y.style.cssText="position: fixed;opacity: 0.9;right: 0;bottom: 0",document.body.appendChild(y)),Be=!0}function _e(n){n===void 0&&(n=f.HideMin|f.HideMax|f.HideMean|f.RoundValues),Z();var e=new J(N),t=new Y("FPS",n,"",e);y.appendChild(t.element);var i=2/121,l=0,a=60;function s(o){l>0&&(a+=i*(1e3/(o-l)-a)),l=o,e.addSample(a),t.invalidate(),requestAnimationFrame(s)}requestAnimationFrame(s)}function xe(n){if(n===void 0&&(n=f.HideMin|f.HideMean),Z(),performance.memory===void 0)return;var e=new J(N),t=new Y("Memory",n,"MB",e);y.appendChild(t.element);function i(){e.addSample(Math.round(performance.memory.usedJSHeapSize/(1024*1024))),t.invalidate(),setTimeout(i,30)}i()}var Ge=function(){function n(e,t,i){this.data=new J(N),this.widget=new Y(e,i,t,this.data),this.startTime=-1}return n}(),A={},rt=function(){function n(e,t){var i=this;this.data=t===void 0?new De:new Ve(t),this.widget=new Le(e,this.data),this.data.onChange=function(){i.widget.invalidate()}}return n}();function ge(n,e){e===void 0&&(e=0),Z();var t=A[n];t===void 0&&(A[n]=t=new Ge(n,"ms",e),y.appendChild(t.widget.element))}function ye(n){var e=A[n];e!==void 0&&(e.startTime=performance.now())}function be(n){var e=performance.now(),t=A[n];t!==void 0&&t.startTime!==-1&&(t.data.addSample(e-t.startTime),t.widget.invalidate())}var we=Object,ze=Symbol,Fe=/\B([A-Z])/g;function Ee(n){return n.replace(Fe,"-$1").toLowerCase()}var L=n=>typeof n=="function";var O,C=1,X=2,Te=4,W=8;var Me=32,Qe=(n,e)=>n.e-e.e,h,d,_,v=0,P,R=0,ee=0,$e=0,Ue=0;function ke(){R++}function He(){if(R>1){R--;return}let n,e=!1;for(;P;){let t=P.sort(Qe),i=0,l=t.length;for(P=O,ee++;i<l;i++){let a=t[i];if(a.a&=~X,!(a.a&W)&&Ke(a))try{a.f()}catch(s){e||(n=s,e=!0)}}}if(ee=0,R--,e)throw n}function Ke(n){let e=n.b,t=e.length,i=0,l;for(;i<t;i++)if(l=e[i],l.d>n.d||l.f())return!0;return!1}function Je(){let n=d.b;if(_){if(Ce(),v>0){let i=_.length,l=0;for(n.length=v+i;l<i;l++)n[v+l]=_[l]}else n=d.b=_;let e=n.length,t=v;for(;t<e;t++){let i=n[t];d.a&Me&&i.k(d)}}else v<d.b.length&&(Ce(),n.length=v)}function Ce(){let n=d.b,e=n.length,t=v;for(;t<e;t++)n[t].i(d)}function Se(n){let e=n.b,t=e.length,i=0;for(;i<t;i++)e[i].i(n);e.length=0}var D=class{d=-1;g=-1;h=[];c;constructor(e){let t=this;t.c=e}f(){return!1}k(e){this.h.push(e)}i(e){let i=this.h,l=i.indexOf(e);i.splice(l,1)}peek(){return this.c}get value(){let e=this;return d&&d.g!==e.g&&(e.g=d.g,_?_.push(e):d.b[v]===e?v++:_=[e]),e.c}set value(e){let t=this;if(t.c!==e&&(t.c=e,t.d=++$e,ee<100)){let i=t.h,l=i.length,a=0;for(ke();a<l;a++)i[a].l();He()}}};var j=class{d=0;g=0;b=[];a=Me;e=0;j;constructor(e){let t=this;t.j=e}f(){let e=this,t=e.a;if(t&C)return;e.d=$e,e.g=Ue++,e.a=t&~Te|C;let i=d,l=_,a=v;try{ke(),d=e,_=O,v=0,e.j()}finally{Je(),d=i,_=l,v=a,e.a&=~C,e.a&W&&Se(e),He()}}l(){let e=this;e.a&(X|C)||(e.a|=Te|X,(P||=[]).push(e))}n(){let e=this;e.a|=W,e.a&C||Se(e)}},V=class{constructor(e){let t=this;t.scopes=[],t.cleanups=[],t.parent=O,t.e=0,!e&&h&&(t.parent=h,t.e=h.e+1,h.scopes.push(t))}run(e){let t=h;try{return h=this,e()}finally{h=t}}clear(){let e=this,t=e.scopes,i=e.cleanups;for(let l of t)l.clear(),l.parent=O;for(let l of i)l();t.length=0,i.length=0}};function B(n){return new V(n)}function Ae(n){L(n)&&h&&h.cleanups.push(n)}function te(n){return new D(n)}function T(n){let e=new j(n),t=e.n.bind(e);try{e.f()}catch(i){throw t(),i}return h&&e.b.length>0&&(e.e=h.e,h.cleanups.push(t)),t}var Ye=!1,Ze=1;var S=null,ne=ze(),I=class extends HTMLElement{$m=!1;$c=B(!0);$p={};$h=[];constructor(){super();let e=this,t=e.$p,i=e.constructor.$d;for(let l in i){let a=i[l];t[a]=te(ne)}}connectedCallback(){let e=this;if(!e.$m){e.$m=!0;let t=e.constructor.$c,i=e.constructor.$s,l=e.$c,a=e.$h,s=e.shadowRoot;s||(s=e.attachShadow({mode:"open"}),s.adoptedStyleSheets=i);let o=S;try{S=e,l.run(()=>t(s,e));for(let r=0,u=a.length;r<u;r++){let p=a[r],c=p();L(c)&&l.cleanups.push(c)}a.length=0}finally{S=o}}}disconnectedCallback(){let e=this;e.$m&&(e.$c.clear(),e.shadowRoot.innerHTML="",e.$m=!1)}attributeChangedCallback(e,t,i){let l=this,a=l.constructor.$d;e in a&&(l.$p[a[e]].value=i===""?!0:i)}};function ie(n,e,t,i){let l=[],a=we.create(null);class s extends I{static observedAttributes=l;static $c=e;static $a=a;static $d=t;static $s=i}for(let o in t){let r=t[o],u=Ee(o);a[u]=o,l.push(u),we.defineProperty(s.prototype,o,{get(){return this.$p[r].c},set(p){this.$p[r].value=p}})}return Ye&&(n="velvet-"+Ze++),n&&customElements.define(n,s),s}function le(n,e){let t=S.$p[n];return t.value===ne&&(t.value=L(e)?e():e),t}function E(n,e){let t=document.createElement("template");if(t.innerHTML=n,e){let i=t.content,l=i.firstChild,a;for(l.remove();a=l.firstChild;)i.appendChild(a)}return t}function M(n){return document.importNode(n.content,!0)}function m(n){return n.firstChild}function g(n){return n.nextSibling}function $(n,e,t){if(n.replaceWith(e),t){let i;for(;i=n.firstChild;)e.appendChild(i)}}function G(n,e){n.append(e)}function q(n,e){n.after(e)}function Ne(n,e){let t=n;if(e.nextSibling!==n)for(;t;){let i=t;if(t=t.nextSibling,i.remove(),i===e)break}}function z(n,e,t){n.setAttribute(e,t)}function k(n,e,t){let i=document.createTextNode("");t(n,i),T(()=>i.data=e())}function se(n,e,t,i){let l=[],a=h.a+1,s=null;T(()=>{let o=t(),r=0,u=o.length,p=l.length;if(i&&s&&u>0){let c=s[0],x=s[1];c.clear(),Pe(n,x),s=null}for(;r<u;r++)if(l[r]){let c=l[r][2];c.value=o[r]}else{let c=l[r-1],x=c?c[1]:n,b=te(o[r]),w=B(!0);w.a=a,l[r]=[w,w.run(()=>e(x,b,r)),b]}if(p>u){let c=l[r-1],x=c?c[1]:n,b=l[p-1][1];for(;r<p;r++)l[r][0].clear();Pe(x,b),l.length=u}if(i&&!s&&u<1){let c=B(!0);c.a=a,s=[c,c.run(()=>i(n))]}}),Ae(()=>{for(let o=0,r=l.length;o<r;o++)l[o][0].clear()})}function Pe(n,e){Ne(n.nextSibling,e)}var Xe=E("<table class='table table-striped latest-data'><tbody><!></tbody></table>"),We=E("<tr><td class=dbname><!></td><td class=query-count><span> <!> </span></td></tr>"),et=E("<td><!> <div class='popover left'><div class=popover-content></div><div class=arrow></div></div></td>");function tt(n,e){let t=le(0,()=>[]),i=M(Xe);se(m(m(m(i))),(r,u)=>{let p=M(We),c=m(p),x=m(c),b=m(x),w=g(x),re=m(w),oe=g(m(re)),it=g(oe),Re=(Oe,Q)=>{let ce=M(et),U=m(ce),ue=m(U),fe=m(g(g(ue))),at=g(fe);return T(()=>z(U,"class",`Query ${Q.value.elapsedClassName}`)),k(ue,()=>Q.value.formatElapsed,$),k(fe,()=>Q.value.query,G),q(Oe,ce),U};return k(b,()=>u.value.dbname,$),T(()=>z(re,"class",u.value.lastSample.countClassName)),k(oe,()=>u.value.lastSample.nbQueries,$),se(w,Re,()=>u.value.lastSample.topFiveQueries),q(r,p),c},()=>t.value),G(n,i)}var ae=ie("x-app",tt,{dbs:0},[]);ae.prototype.attachShadow=function(){return this};var F=new ae;F.dbs=ENV.generateData().toArray();document.body.appendChild(F);if(/[&?]perfmon=(false|off|0)\b/.test(location.search)){let n=function(){let e=ENV.generateData().toArray();F.dbs=e,setTimeout(n,ENV.timeout)};n()}else{let n=function(){let e=ENV.generateData().toArray();ye("view update"),F.dbs=e,be("view update"),setTimeout(n,ENV.timeout)};_e(),xe(),ge("view update"),n()}
//# sourceMappingURL=index.js.map
